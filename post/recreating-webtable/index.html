<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.3.1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><!-- SEO --><title>Retracing Google’s steps: recreating the Webtable in Rust | fjall-rs</title><meta name="title" content="Retracing Google’s steps: recreating the Webtable in Rust"><meta name="description" content="The key-value design to store the entire internet"><!-- OG --><meta property="og:title" content="Retracing Google’s steps: recreating the Webtable in Rust"><meta property="og:description" content="The key-value design to store the entire internet"><meta property="og:url" content="https://fjall-rs.github.io/post/recreating-webtable/"><meta property="og:image" content="https://fjall-rs.github.io/media/thumbs/google.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://fjall-rs.github.io/post/recreating-webtable/"><meta property="twitter:title" content="Retracing Google’s steps: recreating the Webtable in Rust"><meta property="twitter:description" content="The key-value design to store the entire internet"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.DIkHUG1B.js"></script><link rel="stylesheet" href="/_astro/index.D0snRgT7.css">
<style>@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-cyrillic-ext-400-normal.tyfMZHQw.woff2) format("woff2"),url(/_astro/inter-cyrillic-ext-400-normal.CzG7Kr3z.woff) format("woff");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-cyrillic-400-normal.Df6ckaLK.woff2) format("woff2"),url(/_astro/inter-cyrillic-400-normal.JrS_4yms.woff) format("woff");unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-greek-ext-400-normal.CIdlr5YK.woff2) format("woff2"),url(/_astro/inter-greek-ext-400-normal._Rr29XE2.woff) format("woff");unicode-range:U+1F00-1FFF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-greek-400-normal.DQXyrmoy.woff2) format("woff2"),url(/_astro/inter-greek-400-normal.DvIPHDQ7.woff) format("woff");unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-vietnamese-400-normal.Cnt0N5Vm.woff2) format("woff2"),url(/_astro/inter-vietnamese-400-normal.DIOGfGLL.woff) format("woff");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-latin-ext-400-normal.D3W-OpO-.woff2) format("woff2"),url(/_astro/inter-latin-ext-400-normal.8tIzm-yw.woff) format("woff");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/inter-latin-400-normal.BT1H-PT_.woff2) format("woff2"),url(/_astro/inter-latin-400-normal.Cdi8t5Mu.woff) format("woff");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}:not(.astro-code *){font-family:Inter,sans-serif}
:target{scroll-margin-top:80px!important}article{overflow-x:hidden}article a{color:#075985!important;text-decoration:underline dotted!important;text-underline-offset:3px;display:inline-block;transition:transform .1s ease-in-out,filter .1s ease-in-out}article a:hover{transform:translateY(-2px)}.dark article a{color:#38bdf8!important}code:before,code:after{display:none}.astro-code{font-size:15px}p code{border-radius:4px;padding:2px 4px;white-space:normal!important}p strong{color:#c1e4f8!important}.dark p code{color:#c1e4f8!important;background:#07598554!important}html:not(.dark) p code{color:#045280!important;background:#99d4f566!important}.dark article blockquote{border-left-color:#064566!important}html:not(.dark) article blockquote{border-left-width:.25rem;border-left-style:solid;border-left-color:#63c8ff!important}html.dark .astro-code,html.dark .astro-code span{color:var(--shiki-dark)!important;background-color:var(--shiki-dark-bg)!important;font-style:var(--shiki-dark-font-style)!important;font-weight:var(--shiki-dark-font-weight)!important;text-decoration:var(--shiki-dark-text-decoration)!important}
</style><script type="module" src="/_astro/page.VIllvXJD.js"></script><style>[data-astro-transition-scope="astro-x7amp3kc-1"] { view-transition-name: astro-x7amp3kc-1; }@layer astro { ::view-transition-old(astro-x7amp3kc-1) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(astro-x7amp3kc-1) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(astro-x7amp3kc-1) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(astro-x7amp3kc-1) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style><style>[data-astro-transition-scope="astro-x7amp3kc-2"] { view-transition-name: astro-x7amp3kc-2; }@layer astro { ::view-transition-old(astro-x7amp3kc-2) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(astro-x7amp3kc-2) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(astro-x7amp3kc-2) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(astro-x7amp3kc-2) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-2"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-2"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-2"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-2"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style><style>[data-astro-transition-scope="astro-x7amp3kc-3"] { view-transition-name: astro-x7amp3kc-3; }@layer astro { ::view-transition-old(astro-x7amp3kc-3) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(astro-x7amp3kc-3) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(astro-x7amp3kc-3) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(astro-x7amp3kc-3) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-3"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-3"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-3"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-3"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-3"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-3"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-3"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-3"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style><style>[data-astro-transition-scope="astro-x7amp3kc-4"] { view-transition-name: data_20modelling; }@layer astro { ::view-transition-old(data_20modelling) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(data_20modelling) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(data_20modelling) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(data_20modelling) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-4"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-4"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-4"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-4"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-4"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-4"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-4"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-4"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style><style>[data-astro-transition-scope="astro-x7amp3kc-5"] { view-transition-name: project; }@layer astro { ::view-transition-old(project) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(project) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(project) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(project) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-5"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-5"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-5"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-5"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-5"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-5"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-5"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-5"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style><style>[data-astro-transition-scope="astro-x7amp3kc-6"] { view-transition-name: wide_20column; }@layer astro { ::view-transition-old(wide_20column) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(wide_20column) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(wide_20column) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(wide_20column) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-6"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-6"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-6"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-6"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x7amp3kc-6"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x7amp3kc-6"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x7amp3kc-6"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x7amp3kc-6"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style></head> <body class="text-gray-700 dark:text-gray-400 dark:bg-gray-950"> <header class="backdrop-blur w-full px-3 md:px-7 py-5 fixed z-10 border-b dark:border-gray-900 bg-white/80 dark:bg-gray-950/75"> <div class="flex items-center gap-3 md:gap-5 mx-auto w-full max-w-3xl"> <a class="text-black dark:text-white font-medium transition-colors hover:brightness-80" href="/" class="md:text-lg"> <!-- SETUP: If you have a logo, replace this component with it --><span class="md:text-lg whitespace-pre"> fjall-rs </span> </a> <div class="flex-grow"></div> <div class="flex items-center gap-4"> <a href="/posts" class="text-gray-800 dark:text-gray-400 transition-colors hover:brightness-80"> Posts </a><a href="/tags" class="text-gray-800 dark:text-gray-400 transition-colors hover:brightness-80"> Tags </a> </div> <div class="flex items-center gap-3"> <a href="/search" aria-label="Search content" class="transition-all hover:brightness-80 hover:scale-105"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path><path d="M21 21l-6 -6"></path></svg> </a> <button aria-label="Switch theme" class="theme-switch transition-all hover:brightness-80 hover:scale-105"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path></svg> </button> <script>
  const iconMoon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" /></svg>`;
  const iconSun = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" /><path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" /></svg>`;

  function theme() {
    const local = localStorage.getItem("theme");
    if (local) {
      return local;
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  }

  function registerStuff(document) {
    const root = document.documentElement;
    const themeSwitch = document.querySelector(".theme-switch");

    if (theme() === "light") {
      root.classList.remove("dark");
      themeSwitch.innerHTML = iconMoon;
    } else {
      root.classList.add("dark");
      themeSwitch.innerHTML = iconSun;
    }

    themeSwitch.addEventListener("click", () => {
      const isDark = root.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "light" : "dark");
      console.log(isDark);

      if (isDark) {
        root.classList.remove("dark");
        themeSwitch.innerHTML = iconMoon;
      } else {
        root.classList.add("dark");
        themeSwitch.innerHTML = iconSun;
      }
    });
  }

  registerStuff(document);

  document.addEventListener("astro:after-swap", (ev) => {
    registerStuff(document);
  });
</script> <a target="_blank" href="https://github.com/fjall-rs" aria-label="Open GitHub page" class="transition-all hover:brightness-80 hover:scale-105"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg> </a> <a target="_blank" href="https://discord.gg/HvYGp4NFFk" aria-label="Join Discord server" class="transition-all hover:brightness-80 hover:scale-105"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-discord"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M8 12a1 1 0 1 0 2 0a1 1 0 0 0 -2 0"></path><path d="M14 12a1 1 0 1 0 2 0a1 1 0 0 0 -2 0"></path><path d="M15.5 17c0 1 1.5 3 2 3c1.5 0 2.833 -1.667 3.5 -3c.667 -1.667 .5 -5.833 -1.5 -11.5c-1.457 -1.015 -3 -1.34 -4.5 -1.5l-.972 1.923a11.913 11.913 0 0 0 -4.053 0l-.975 -1.923c-1.5 .16 -3.043 .485 -4.5 1.5c-2 5.667 -2.167 9.833 -1.5 11.5c.667 1.333 2 3 3.5 3c.5 0 2 -2 2 -3"></path><path d="M7 16.5c3.5 1 6.5 1 10 0"></path></svg> </a> </div> </div> </header> <main class="px-4 pt-30 mx-auto max-w-3xl">   <div class="reading-progress z-10 fixed left-0 top-0 h-1 dark:bg-blue-500 bg-blue-700 opacity-75"></div> <script>
  /**
   * Gets the vertical scroll percent (0.0 - 1.0)
   */
  function getScrollPercent() {
    const doc = document.documentElement;
    const body = document.body;

    return (
      (doc.scrollTop || body.scrollTop) /
      ((doc.scrollHeight || body.scrollHeight) - doc.clientHeight)
    );
  }

  document.addEventListener("astro:page-load", () => {
    document.addEventListener("scroll", () => {
      const el = document.querySelector(".reading-progress");
      if (el) {
        el.style.width = `${getScrollPercent() * 100}%`;
      }
    });
  });
</script> <div class="flex flex-col gap-4"> <h1 class="text-blue-800 dark:text-blue-400 text-4xl md:text-5xl font-bold"> Retracing Google’s steps: recreating the Webtable in Rust </h1> <div class="flex items-center gap-2">  <div> March 21, 2025 </div> 
- <div>21 min. read</div>  </div> <ul class="text-sm text-blue-800 dark:text-blue-300 flex flex-wrap items-center gap-3"> <li class="mb-2 transition-all hover:translate-y-[-1px] hover:brightness-90">  <a class="transition-all bg-blue-400/10 dark:bg-blue-800/10 hover:dark:bg-blue-800/30 rounded p-2" href="/tag/data modelling" data-astro-transition-scope="astro-x7amp3kc-4">
#data modelling </a> </li><li class="mb-2 transition-all hover:translate-y-[-1px] hover:brightness-90">  <a class="transition-all bg-blue-400/10 dark:bg-blue-800/10 hover:dark:bg-blue-800/30 rounded p-2" href="/tag/project" data-astro-transition-scope="astro-x7amp3kc-5">
#project </a> </li><li class="mb-2 transition-all hover:translate-y-[-1px] hover:brightness-90">  <a class="transition-all bg-blue-400/10 dark:bg-blue-800/10 hover:dark:bg-blue-800/30 rounded p-2" href="/tag/wide column" data-astro-transition-scope="astro-x7amp3kc-6">
#wide column </a> </li> </ul> <img class="mt-5 rounded-xl w-full object-cover bg-center aspect-2" src="/media/thumbs/google.jpg" alt="Blog post thumbnail"> </div>  <article class="my-10 w-full !max-w-full prose dark:prose-invert text-justify dark:prose-gray"> <p>Everyone knows Google. For almost the entire’s internet lifetime, the Google search page has been the starting point of almost any internet user’s surfing session.
To be able to serve search requests of (almost) anything that can be found on the internet, Google has to manage a huge search index.
Storing a large portion of the internet requires petabytes, <a href="https://cloud.google.com/blog/topics/developers-practitioners/how-big-cloud-bigtable?hl=en">if not exabytes</a>, of storage.</p>
<h2 id="bigtable">Bigtable</h2>
<p>After a couple of years, the growth of Google needed a new database solution to manage its growing datasets.
The solution was <code>Bigtable</code>, a massively scalable database, still in use today.</p>
<p>Bigtable is a distributed wide-column database (somewhat exotic these days); you can think of it as a key-key-value database, where the first key maps to a row, and the second key to a column, which then contains a value, forming a 2D grid.
Bigtable additionally allows versioning of any cell, forming a cube.</p>
<p>Ultimately, the key schema used by Bigtable is basically: <code>&#x3C;row key>.&#x3C;col fam>.&#x3C;col qual>.&#x3C;ts></code>.</p>
<p>To insert a cell, you need to specify a row key, column key (column family + column qualifier) and a timestamp.
The column qualifier <a href="https://systems.cs.columbia.edu/ds1-class/lectures/09-bigtable.pdf">can be empty</a> (denoted by the syntax <code>family:</code>).</p>
<p>The row key defines how the table is ordered, so it is the only indexing mechanism (there are no secondary indexes).</p>
<div style="margin-top: 10px; width: 100%; display: flex; justify-content: center">
  <img style="border-radius: 16px; max-height: 500px" src="/media/posts/recreating-webtable/bigtable_tablet_server_arch.png">
</div>
<div class="text-sm mt-2" style="text-align: center; opacity: 0.75">
  <i>Bigtable itself is essentially a distributed LSM-tree, in which each tablet server (pictured here) holds a small piece of the entire keyspace - taken from the <a href="https://static.googleusercontent.com/media/research.google.com/de//archive/bigtable-osdi06.pdf">original Bigtable paper</a></i>
</div>
<h2 id="the-descendants-of-bigtable-leveldb--rocksdb">The descendants of Bigtable: LevelDB &#x26; RocksDB</h2>
<p>LevelDB, an embeddable LSM-tree based key-value storage engine by Google, was released in 2011 and a <a href="https://opensource.googleblog.com/2011/07/leveldb-fast-persistent-key-value-store.html">direct descendent of Bigtable code</a>.
It is now in <a href="https://github.com/google/leveldb/commit/aa5479bbf47e9df86e0afbb89e6246085f22cdd4">maintenance-only mode</a>.</p>
<blockquote>
<p>Fun fact: <a href="https://chromium.googlesource.com/chromium/src/+/refs/heads/main/content/browser/indexed_db/indexed_db_leveldb_coding.cc">Every Chromium browser ships with LevelDB</a>.</p>
</blockquote>
<p>Facebook later forked LevelDB as RocksDB, to <a href="https://rocksdb.blogspot.com/2013/11/the-history-of-rocksdb.html">develop it further</a>; RocksDB is now used in <a href="https://web.archive.org/web/20240621211755/https://rockset.com/blog/rocksdb-is-eating-the-database-world/">countless projects</a>.</p>
<h2 id="the-webtable">The Webtable</h2>
<p>To store essentially the entire internet, Google built the <code>Webtable</code>, a huge Bigtable table that stores HTML pages, links and some metadata of every page they crawl.</p>
<p>The row key of the Webtable is the URL of a page with reversed domain key, e.g. <code>github.com/explore</code> is converted to <code>com.github/explore</code>.
This maximizes locality for URLs with common domains, which we will see in action later on.</p>
<p>The Webtable has a pretty simple data schema:</p>
<ul>
<li>
<p>The <code>language</code> column family stores the Alpha-2 country code of every page.</p>
</li>
<li>
<p>The <code>checksum</code> column family stores a checksum of the web page contents (we will use MD5).</p>
</li>
<li>
<p>The <code>contents</code> column family stores the actual HTML document of every page.</p>
</li>
<li>
<p>The <code>anchor</code> column family is the most interesting one.
For each page A, every column inside the family is the URL of a page B that linked to page A.
The cell value is the link text of the anchor (<code>&#x3C;a></code>) element.</p>
</li>
</ul>
<h2 id="lets-recreate-it-in-rust">Let’s recreate it in Rust</h2>
<p>We will not build a massively scalable database or store the entire internet, but instead recreate the key-value schema used by the Webtable, and make a small scale version of it.</p>
<p>To keep it 100% Rust, we will use Fjall, an LSM-based key-value storage engine heavily inspired by RocksDB.</p>
<p>First we want to create ourselves a little wide column abstraction over our key-value store.
To insert a cell, we can do something like:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">//</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> Using fjall 2.x</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">use</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Config</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">type</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> u64</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> main</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> anyhow</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;()></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> A keyspace is one single database</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Config</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">default</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">open</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> A partition is its own isolated collection/table/... (backed by an LSM-tree)</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">open_partition</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"webtable"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Default</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">default</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> We will use \0 as delimiters</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> mut</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> wide_col_key</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"jupiter</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">metrics</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">mass</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">to_vec</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    wide_col_key</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">extend</span><span style="color:#908CAA;--shiki-dark:#908CAA">((</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">!</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">default</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">to_be_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">());</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ------------------^</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> store timestamp inverted, so cell versions are sorted in descending order</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> insert fact about Jupiter</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">wide_col_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"metric f*+!ton"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">    Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(())</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span>
<span class="line"></span></code></pre>
<p>And to retrieve a row, we do:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">//</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> list all columns of Jupiter</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> kv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"jupiter</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#908CAA;--shiki-dark:#908CAA"> (</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">k</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> v</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> kv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> mut</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> k</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">split</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">x</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> x</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> ==</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b</span><span style="color:#908CAA;--shiki-dark:#908CAA">'</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#908CAA;--shiki-dark:#908CAA">'</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> row_key</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> col_fam</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> col_qua</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> mut</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> buf</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#908CAA;--shiki-dark:#908CAA"> [</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">mem</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">size_of</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">>()];</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    buf</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">copy_from_slice</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">k</span><span style="color:#908CAA;--shiki-dark:#908CAA">[</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">k</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">len</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">mem</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">size_of</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">>()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">..</span><span style="color:#908CAA;--shiki-dark:#908CAA">]);</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> !</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_be_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">buf</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> -------------^</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> We store timestamp in reverse order, so we need to un-reverse</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> v</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> String</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8_lossy</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">v</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">    eprintln!</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">row_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">@</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">col_fam</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">:</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">col_qua</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">ts</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177"> has value </span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">v:?</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>basically just splitting the compound row key back into its constituent parts, which then yields:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="log"><code><span class="line"><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">jupiter@metrics:mass?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> has value </span><span style="color:#F6C177;--shiki-dark:#F6C177">"metric f*+!ton"</span></span>
<span class="line"><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">jupiter@metrics:radius?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> has value </span><span style="color:#F6C177;--shiki-dark:#F6C177">"big"</span></span></code></pre>
<p>This is just some debug syntax I came up with - everything before the <code>@</code> is the <code>row key</code>, followed by the <code>column key</code> (<code>column family:qualifier</code>), which is followed by a <code>?</code> delimiter and the <code>timestamp</code>.</p>
<p>We can query just a specific column family or even a specific column by simply changing the prefix string of a prefix query:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">//</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> Filter by column family</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> kv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"jupiter</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">metrics</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">  //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ...</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">//</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> Get a specific column</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> kv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"jupiter</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">metrics</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">mass</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">  //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ...</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>And we could even do historic queries over a specific cell, e.g. to retrieve a previous HTML version of a web page.</p>
<h3 id="creating-a-wide-column-module">Creating a Wide Column module</h3>
<p>Let’s make a nicer module to work with.
For storing a cell, we can simply provide an <code>insert</code> method, which will serialize the cell key using the key schema we defined:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">type</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> u64</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">struct</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    #[</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">allow</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">unused</span><span style="color:#908CAA;--shiki-dark:#908CAA">)]</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    primary</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Partition</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> name</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">Self</span><span style="color:#908CAA;--shiki-dark:#908CAA">></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> primary</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">open_partition</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">name</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Default</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">default</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">        Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">Self</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> primary</span><span style="color:#908CAA;--shiki-dark:#908CAA"> })</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">self</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        row_key</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        col_family</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        col_qual</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        ts</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Option</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">>,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        value</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#908CAA;--shiki-dark:#908CAA">[</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">u8</span><span style="color:#908CAA;--shiki-dark:#908CAA">],</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    )</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;()></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell_key</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> serialize_cell_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">row_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> col_family</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> col_qual</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> ts</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">primary</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">cell_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> value</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>And to get back some cells, we can create an <code>Iterator</code> which will deserialize key-value pairs back to a <code>TableCell</code> struct:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">  //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ... rest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">  pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">self</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        prefix</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Into</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Slice</span><span style="color:#908CAA;--shiki-dark:#908CAA">>,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    )</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Iterator</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Item</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">TableCell</span><span style="color:#908CAA;--shiki-dark:#908CAA">>></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">primary</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">prefix</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">into</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">map</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">kv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">            //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ignore the TableCell::new syntax, it's some nasty self_cell stuff</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">            Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">TableCell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">kv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> |</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">k</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> v</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> mut</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> k</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">split</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">x</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">|</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> x</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> ==</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b</span><span style="color:#908CAA;--shiki-dark:#908CAA">'</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#908CAA;--shiki-dark:#908CAA">'</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> row_key</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> column_family</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> column_qualifier</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_utf8</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> ts_bytes</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> splits</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">next</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> mut</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> buf</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#908CAA;--shiki-dark:#908CAA"> [</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">mem</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">size_of</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">>()];</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                buf</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">copy_from_slice</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">ts_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> !</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">from_be_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">buf</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">                CellInner</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                    row_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                    column_family</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                    column_qualifier</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                    timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                    value</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">v</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">                }</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">            }))</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        })</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>Now we have a really nice API to work with our wide-column data.
Here’s the previous example with the new module:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> main</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> anyhow</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;()></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Config</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">default</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">open</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "webtable"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"jupiter"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "metrics"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "mass"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"metric f*+!ton"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"jupiter"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "metrics"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "radius"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"big"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> None is the default timestamp = 0 -----------^</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"jupiter</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">        eprintln!</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">cell:?</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<h3 id="storing-the-page-language">Storing the page language</h3>
<p>Now we can finally start actually modelling the Webtable.
First , let us store the simplest column family in the Webtable, <code>language</code>:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">//</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> It doesn't matter what order we insert in, the row key will determine the table order</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"de.ndr"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "language"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"DE"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"is.vedur"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "language"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"IS"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"com.google"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "language"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> b"EN"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">//</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ... more data here</span></span></code></pre>
<p>Now scanning the table, we get:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">com</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">github</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">@</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">language</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =></span><span style="color:#F6C177;--shiki-dark:#F6C177"> "EN"</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">com</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">google</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">@</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">language</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =></span><span style="color:#F6C177;--shiki-dark:#F6C177"> "EN"</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">com</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">google</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">drive</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">@</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">language</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =></span><span style="color:#F6C177;--shiki-dark:#F6C177"> "EN"</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">com</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">google</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">meet</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">@</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">language</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =></span><span style="color:#F6C177;--shiki-dark:#F6C177"> "EN"</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">de</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">ndr</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">@</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">language</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =></span><span style="color:#F6C177;--shiki-dark:#F6C177"> "DE"</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">is</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">vedur</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">@</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">language</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =></span><span style="color:#F6C177;--shiki-dark:#F6C177"> "IS"</span></span></code></pre>
<p>You can see how - because of the reversed domain key - all Google domains live next to each other.</p>
<h3 id="storing-the-web-page-itself">Storing the web page itself</h3>
<p>Every web page is an HTML document.
This document is stored as is in the <code>contents</code> column family (again, no column qualifier).
We will also compute a MD5 hash and store it in the <code>checksum</code> column family.</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> unix_timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">time</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">SystemTime</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::UNIX_EPOCH</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">elapsed</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_secs</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> html_str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "&#x3C;html lang=</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\"</span><span style="color:#F6C177;--shiki-dark:#F6C177">is</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\"</span><span style="color:#F6C177;--shiki-dark:#F6C177">>..."</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "is.vedur"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "contents"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">    Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">unix_timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">),</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    html_str</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "is.vedur"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "checksum"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">    Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">unix_timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">),</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">    md5</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">compute</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">html_str</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_slice</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span></code></pre>
<p>Now we can see how our table fills up with more columns:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="log"><code><span class="line"><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">// ...</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@checksum:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">1741886589</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"����h�s\"</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">H8��\u{</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">3</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">}PD"</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@contents:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">1741886589</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"&#x3C;html lang=\"</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">is\</span><span style="color:#F6C177;--shiki-dark:#F6C177">">..."</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@language:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"IS"</span></span></code></pre>
<p>Most column families are stored using a timestamp such that we get a history of values.
This allows storing multiple versions of the same web page, and get rid of old versions lazily.</p>
<div style="margin-top: 10px; width: 100%; display: flex; justify-content: center">
  <img style="border-radius: 16px; max-height: 500px" src="/media/posts/recreating-webtable/webtable_model.png">
</div>
<div class="text-sm mt-2" style="text-align: center; opacity: 0.75">
  <i>The basic Webtable data model - taken from the <a href="https://static.googleusercontent.com/media/research.google.com/de//archive/bigtable-osdi06.pdf">original Bigtable paper</a></i>
</div>
<h3 id="storing-the-anchors">Storing the anchors</h3>
<p>Now we have a very simple dictionary of URLs and can retrieve their language, HTML source and checksum.
However, what really makes the internet work is anchors (a.k.a. links) that connect pages.</p>
<p>Webtable stores each anchor from page A that points to page B under the row key of page B in the <code>anchor</code> column family.
The column qualifier is the name of page A (the referrer).
The value is the anchor text.
So if I were to link you to <a href="https://vedur.is">Iceland’s weather service</a>, Webtable would store that anchor as:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "is.vedur"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "anchor"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    "fjall-rs.github.io/post/recreating-webtable"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">    None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">    b"Iceland's weather service"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span></code></pre>
<p>And we can see the anchors now showing up in our scan:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="log"><code><span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@anchor:</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">fjall.github</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">.io/post/recreating-webtable?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"Iceland's weather service"</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@checksum:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">1741886589</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"����h�s\"</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">H8��\u{</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">3</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">}PD"</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@contents:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">1741886589</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"&#x3C;html lang=\"</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">is\</span><span style="color:#F6C177;--shiki-dark:#F6C177">">..."</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">is.vedur</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@language:?</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">0</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"IS"</span></span></code></pre>
<p>This way we can easily count inbound anchors of <em>any</em> web page for <code>PageRank</code>, the <a href="https://snap.stanford.edu/class/cs224w-readings/Brin98Anatomy.pdf">very idea Google was built on</a>.</p>
<p>And that’s it! We can now store pages and anchors to store data for a search engine (left as an exercise for the reader).</p>
<h3 id="creating-a-webtable-module">Creating a Webtable module</h3>
<p>To make the API even nicer, we can further hide the <code>WideColumnTable</code> module behind a <code>Webtable</code> API, that deals with the HTML parsing (powered by <code>visdom</code>) etc.:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">use</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> visdom</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Vis</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> types</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Elements</span><span style="color:#908CAA;--shiki-dark:#908CAA">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">struct</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Webtable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Webtable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> parse_anchors</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;'</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">a</span><span style="color:#908CAA;--shiki-dark:#908CAA">>(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">root</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Elements</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;'</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">a</span><span style="color:#908CAA;--shiki-dark:#908CAA">>)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Elements</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;'</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">a</span><span style="color:#908CAA;--shiki-dark:#908CAA">></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> anchors</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> root</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">find</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"a"</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        anchors</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> iter_anchors_to_page</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">self</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        rev_domain</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    )</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Iterator</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Item</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Cell</span><span style="color:#908CAA;--shiki-dark:#908CAA">>></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> prefix</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> format!</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">rev_domain</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">anchor</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\0</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">self</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> url</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> html</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">str</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;()></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> rev_url</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> reverse_domain_key</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">url</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">trim_start_matches</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"https://"</span><span style="color:#908CAA;--shiki-dark:#908CAA">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> unix_timestamp</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> std</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">time</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">SystemTime</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::UNIX_EPOCH</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">elapsed</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_secs</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">root</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Vis</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">load</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">html</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> else</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            return</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(());</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        if</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> let</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">lang</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> root</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">find</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"html"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">attr</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"lang"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> lang</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> lang</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">to_string</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">inner</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                .</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">rev_url</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "language"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> None</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> lang</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">())</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">rev_url</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">            "contents"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">            ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">            Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">unix_timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">),</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            html</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        )</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">rev_url</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">            "checksum"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">            ""</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">            Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">unix_timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">),</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">            md5</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">compute</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">html</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_slice</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        )</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">        //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> To get the list of anchors, we will need to parse out all anchors out of the HTML document</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> anchor</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> Self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">parse_anchors</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">root</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            let</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">href</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> anchor</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">get_attribute</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"href"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> else</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                continue</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">            };</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> href</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> href</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">to_string</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            if</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> href</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">starts_with</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"mailto:"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">                //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ... filter out some stuff ...</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">            {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                continue</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">            //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> imagine some string magic here</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">            let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> href</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> normalize_href</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">href</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">                &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">href</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#F6C177;--shiki-dark:#F6C177">                "anchor"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                url</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">                Some</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">unix_timestamp</span><span style="color:#908CAA;--shiki-dark:#908CAA">),</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">                anchor</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">text</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">as_bytes</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">            )</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">        Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(())</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<h3 id="scraping-some-pages">Scraping some pages</h3>
<p>And now we can easily download some pages (using some HTTP client, <code>reqwest</code> in this case) and store it:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> test_urls</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#908CAA;--shiki-dark:#908CAA"> [</span><span style="color:#F6C177;--shiki-dark:#F6C177">"https://vedur.is"</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "https://news.ycombinator.com"</span><span style="color:#908CAA;--shiki-dark:#908CAA">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> url</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> test_urls</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">    eprintln!</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"Scraping </span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">url:?</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> res</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> reqwest</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">blocking</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">get</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">url</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    if</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> res</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">status</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">is_success</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> html</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> res</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">text</span><span style="color:#908CAA;--shiki-dark:#908CAA">()</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">unwrap</span><span style="color:#908CAA;--shiki-dark:#908CAA">();</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">insert</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">url</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> &#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">html</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>If we now look at the database, we can see - after scraping the <a href="https://news.ycombinator.com/"><code>Hacker News</code></a> front page - a new anchor (amongst others):</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="log"><code><span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">org.duckdb</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">@anchor:</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">https://news.ycombinator.com?1741886589</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> => </span><span style="color:#F6C177;--shiki-dark:#F6C177">"The DuckDB Local UI"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">// ... rest</span></span></code></pre>
<p>Which basically means: <code>duckdb.org</code> was linked to by <code>news.ycombinator.com</code> using the text <code>"The DuckDB Local UI"</code>.</p>
<p>With the <code>iter_anchors_to_page</code> method, we can scan over the anchors that point to a web page:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">for</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> in</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> webtable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">iter_anchors_to_page</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"org.duckdb"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> cell</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"><span style="color:#EA9A97;--shiki-dark:#EA9A97">    eprintln!</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">{</span><span style="color:#F6C177;--shiki-dark:#F6C177">cell:?</span><span style="color:#908CAA;--shiki-dark:#908CAA">}</span><span style="color:#F6C177;--shiki-dark:#F6C177">"</span><span style="color:#908CAA;--shiki-dark:#908CAA">);</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>which will give the same anchor as above (but not others).</p>
<h3 id="locality-groups">Locality groups</h3>
<p>The current data schema can run into a problem though:
if we wanted to aggregate how many web pages exist per language, we would have to scan the entire table, including all HTML documents.
That would be prohibitely slow.</p>
<p>Bigtable has a feature called “locality groups”, that allows grouping certain column families together, which allows data partitioning:</p>
<blockquote>
<p>Segregating column families that are not typically accessed together into separate locality groups enables more efficient reads.</p>
<p>For example, page metadata in Webtable (such as language and checksums) can be in one locality group, and the contents of the page can be in a different group: an application that wants to read the metadata does not need to read through all of the page contents.</p>
</blockquote>
<p>To do that, we can simply write the column families we want into a new <code>WideColumnTable</code>, which will internally create a new LSM-tree:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto;" tabindex="0" data-language="rs"><code><span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">struct</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Webtable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    #[</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">allow</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">unused</span><span style="color:#908CAA;--shiki-dark:#908CAA">)]</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    lg_meta</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">    lg_contents</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Webtable</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">:</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">Self</span><span style="color:#908CAA;--shiki-dark:#908CAA">></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">        //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> this is where all column families land that are not part of any locality group</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> inner</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">clone</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "webtable"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">        //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> write metadata (checksum and language) into this locality group</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> lg_meta</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">clone</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "lg_meta"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">        //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> write HTML contents into this locality group</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">        let</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> lg_contents</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> WideColumnTable</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">new</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">keyspace</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">clone</span><span style="color:#908CAA;--shiki-dark:#908CAA">(),</span><span style="color:#F6C177;--shiki-dark:#F6C177"> "lg_meta"</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">?</span><span style="color:#908CAA;--shiki-dark:#908CAA">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">        Ok</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">Self</span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            keyspace</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            inner</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            lg_meta</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">            lg_contents</span><span style="color:#908CAA;--shiki-dark:#908CAA">,</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">        })</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">    pub</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> fn</span><span style="color:#EA9A97;--shiki-dark:#EA9A97"> iter_metadata</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">self</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> -></span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> impl</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8"> Iterator</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Item</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> =</span><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic"> fjall</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">::</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Result</span><span style="color:#908CAA;--shiki-dark:#908CAA">&#x3C;</span><span style="color:#9CCFD8;--shiki-dark:#9CCFD8">Cell</span><span style="color:#908CAA;--shiki-dark:#908CAA">>></span><span style="color:#908CAA;--shiki-dark:#908CAA"> {</span></span>
<span class="line"><span style="color:#E0DEF4;font-style:italic;--shiki-dark:#E0DEF4;--shiki-dark-font-style:italic">        self</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">lg_meta</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">.</span><span style="color:#EA9A97;--shiki-dark:#EA9A97">prefix</span><span style="color:#908CAA;--shiki-dark:#908CAA">(</span><span style="color:#F6C177;--shiki-dark:#F6C177">""</span><span style="color:#908CAA;--shiki-dark:#908CAA">)</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#908CAA;font-style:italic;--shiki-dark:#908CAA;--shiki-dark-font-style:italic">    //</span><span style="color:#6E6A86;font-style:italic;--shiki-dark:#6E6A86;--shiki-dark-font-style:italic"> ... rest</span></span>
<span class="line"><span style="color:#908CAA;--shiki-dark:#908CAA">}</span></span></code></pre>
<p>If we now scan over our metadata locality group, we only get the <code>checksum</code> and <code>language</code> of all the pages.</p>
<h3 id="the-end">The end</h3>
<p>And now we finally have a Rust-only, embedded toy <code>Webtable</code>, the central part of the original Google search engine.
To make a fully featured search engine, you would need way more components, including a search index and crawlers; see the original Google paper for more information about that.</p>
<p>Source code can be found <a href="https://github.com/marvin-j97/fjall-webtable">here</a>.</p> <hr> <h2>Discord</h2> <p>
Join the discord server if you want to chat about databases, Rust or whatever: <a href="https://discord.gg/HvYGp4NFFk">https://discord.gg/HvYGp4NFFk</a> </p> <h2>Interested in LSM-trees and Rust?</h2> <p>
Check out <a href="https://github.com/fjall-rs/fjall" target="_blank">fjall</a>, an MIT-licensed
  LSM-based storage engine written in Rust.
</p> <iframe src="https://github.com/sponsors/fjall-rs/card" title="Sponsor fjall" height="80" width="100%" style="border: 0;"></iframe> </article>   <hr class="h-1 mb-2 border-gray-200 dark:border-gray-700"> <div class="flex flex-col gap-3"> <div class="dark:text-gray-300 italic">Tags</div> <ul class="text-sm text-blue-800 dark:text-blue-300 flex flex-wrap items-center gap-3"> <li class="mb-2 transition-all hover:translate-y-[-1px] hover:brightness-90">  <a class="transition-all bg-blue-400/10 dark:bg-blue-800/10 hover:dark:bg-blue-800/30 rounded p-2" href="/tag/data modelling" data-astro-transition-scope="astro-x7amp3kc-1">
#data modelling </a> </li><li class="mb-2 transition-all hover:translate-y-[-1px] hover:brightness-90">  <a class="transition-all bg-blue-400/10 dark:bg-blue-800/10 hover:dark:bg-blue-800/30 rounded p-2" href="/tag/project" data-astro-transition-scope="astro-x7amp3kc-2">
#project </a> </li><li class="mb-2 transition-all hover:translate-y-[-1px] hover:brightness-90">  <a class="transition-all bg-blue-400/10 dark:bg-blue-800/10 hover:dark:bg-blue-800/30 rounded p-2" href="/tag/wide column" data-astro-transition-scope="astro-x7amp3kc-3">
#wide column </a> </li> </ul> </div>  </main> <footer class="flex flex-col gap-5 py-10 mx-auto max-w-3xl w-full"> <!-- TODO: move into a fixed FAB button, outside of footer --> <div class="text-right"> <button onclick="scrollToTop()">Back to top</button> </div> <div class="text-center">
&copy; 2025 fjall-rs 
- powered by <a class="text-blue-700 dark:text-blue-300 italic transition-all hover:brightness-80" href="https://github.com/marvin-j97/nanoblog" target="_blank">
nanoblog
</a>  </div> <div class="flex gap-3 justify-center"> <a target="_blank" href="https://github.com/fjall-rs" aria-label="Open GitHub page" class="transition-all hover:brightness-80 hover:scale-105"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg> </a> <a target="_blank" href="/rss.xml" aria-label="Get RSS feed" class="transition-all hover:brightness-80 hover:scale-105"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path> <path d="M4 4a16 16 0 0 1 16 16"></path> <path d="M4 11a9 9 0 0 1 9 9"></path>  </svg> </a> </div> </footer> <script>
  function scrollToTop() {
    window.scrollTo({
      top: 0,
      left: 0,
      behavior: "smooth",
    });
  }
</script>  </body> </html> 